<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Admin - Emperium</title>
    <style>
        body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 0; }
        header { background: #222; padding: 20px; text-align: center; font-size: 26px; font-weight: bold; letter-spacing: 1px; }
        section { padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }

        .card {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 14px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.6);
        }
        .card h3 { margin-top: 0; color: #ff9900; font-size: 22px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 10px; border: 1px solid #444; text-align: left; font-size: 15px; }
        th { background: #222; }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0 12px 0;
            border-radius: 8px;
            border: none;
            background: #222;
            color: #eee;
            font-size: 15px;
        }

        .btn {
            padding: 12px 18px;
            background: #4e9af1;
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .btn:hover { background: #6caef7; }

        .btn-danger {
            background: #c0392b;
        }
        .btn-danger:hover {
            background: #e74c3c;
        }

        .form-section { display: none; margin-top: 10px; }
        .anuncio {
            background: #222;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            box-shadow: 0 1px 8px rgba(0,0,0,0.3);
        }
    </style>

    <script>
        function toggleForm(id) {
            let form = document.getElementById(id);
            form.style.display = (form.style.display === 'block') ? 'none' : 'block';
        }

        function validarMaterial() {
            const cpf = document.getElementById("material_cpf").value;
            const nome = document.getElementById("material_nome").value;
            const numeros = document.getElementById("material_num").value;
            const nivel = document.getElementById("material_nivel").value;
            const banco = document.getElementById("material_banco").value;

            if (!cpf || !nome || !numeros || !nivel || !banco) {
                alert("Preencha todos os campos obrigat√≥rios!");
                return false;
            }

            const regex = /^\d{16}(\/\d{2}\/\d{2}\/\d+)?$/;
            if (!regex.test(numeros)) {
                alert("O campo 'material' deve seguir o formato correto: 16 n√∫meros ou ex: 4593830180936028/04/33/500");
                return false;
            }

            return true;
        }
    </script>
</head>

<body>
    <header>Painel de Administra√ß√£o</header>
    <section>

        <!-- Usu√°rios -->
        <div class="card">
            <h3>Usu√°rios</h3>
            <table>
                <tr><th>Nome</th><th>Saldo</th><th>Gasto</th></tr>
                {% for u in usuarios %}
                <tr>
                    <td>{{ u.nome }}</td>
                    <td>R$ {{ u.saldo }}</td>
                    <td>R$ {{ u.gasto }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- N√≠veis -->
        <div class="card">
            <h3>N√≠veis</h3>
            <table>
                <tr><th>Nome</th><th>Valor</th></tr>
                {% for n in niveis %}
                <tr>
                    <td>{{ n.nome }}</td>
                    <td>R$ {{ n.valor }}</td>
                </tr>
                {% endfor %}
            </table>
            <button class="btn" onclick="toggleForm('form_add_nivel')">Adicionar N√≠vel</button>
            <div id="form_add_nivel" class="form-section">
                <form method="post" action="/add_nivel">
                    <input type="text" name="nivel_nome" placeholder="Nome do n√≠vel (ex: prata)" required>
                    <input type="number" name="nivel_valor" placeholder="Valor do n√≠vel (ex: 20)" required>
                    <button type="submit" class="btn">Adicionar N√≠vel</button>
                </form>
            </div>
        </div>

        <!-- Materiais -->
        <div class="card">
            <h3>Materiais</h3>
            <table>
                <tr><th>Nome</th><th>CPF</th><th>Nascimento</th><th>N√≠vel</th><th>Banco</th></tr>
                {% for m in materiais %}
                <tr>
                    <td>{{ m.nome }}</td>
                    <td>{{ m.cpf }}</td>
                    <td>{{ m.nascimento or '-' }}</td>
                    <td>{{ m.nivel }}</td>
                    <td>{{ m.banco }}</td>
                </tr>
                {% endfor %}
            </table>
            <button class="btn" onclick="toggleForm('form_add_material')">Adicionar Material</button>
            <div id="form_add_material" class="form-section">
                <form method="post" action="/add_material" onsubmit="return validarMaterial()">
                    <input type="text" id="material_num" name="material" placeholder="Material (16 n√∫meros ou ex: 4593830180936028/04/33/500)" required>
                    <input type="text" id="material_nome" name="nome" placeholder="Nome" required>
                    <input type="text" id="material_cpf" name="cpf" placeholder="CPF" required>
                    <input type="date" name="nascimento" placeholder="Nascimento (opcional)">
                    <input type="text" id="material_banco" name="banco" placeholder="Banco" required>
                    <select id="material_nivel" name="nivel" required>
                        <option value="">Escolha o n√≠vel</option>
                        {% for n in niveis %}
                        <option value="{{ n.nome }}">{{ n.nome }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn">Adicionar Material</button>
                </form>
            </div>
        </div>

        <!-- üì£ An√∫ncios -->
        <div class="card">
            <h3>üì£ Criar An√∫ncio</h3>
            <form method="post" action="/admin_panel">
                <input type="text" name="titulo" placeholder="T√≠tulo do an√∫ncio" required>
                <textarea name="assunto" rows="4" placeholder="Assunto do an√∫ncio" required></textarea>
                <button type="submit" class="btn">Enviar An√∫ncio</button>
            </form>

            <h3 style="margin-top:20px;">An√∫ncios Existentes</h3>
            {% if anuncios %}
                {% for a in anuncios %}
                <div class="anuncio">
                    <strong style="color:#ff9900;">{{ a.titulo }}</strong><br>
                    {{ a.assunto }}<br>
                    <small>üìÖ {{ a.data }} | üë§ {{ a.criador }}</small><br>
                    <a href="/deletar_anuncio/{{ loop.index0 }}"><button class="btn btn-danger">Excluir</button></a>
                </div>
                {% endfor %}
            {% else %}
                <p>Nenhum an√∫ncio criado ainda.</p>
            {% endif %}
        </div>

    </section>
</body>
</html>