<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Aguardando Pagamento - Emperium</title>
<style>
    html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        font-family: "Segoe UI", Arial, sans-serif;
        background: #0b0b0b;
        color: #fff;
        box-sizing: border-box;
    }

    body {
        display: flex;
        justify-content: center;
        align-items: stretch;
    }

    .container {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #101010, #181818);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        padding: 50px 20px;
        box-sizing: border-box;
        overflow-y: auto;
    }

    h2 {
        font-size: 44px;
        margin-bottom: 35px;
        text-align: center;
        color: #c79b4b;
        text-shadow: 0 0 10px rgba(199, 155, 75, 0.4);
    }

    /* EMBED */
    .embed {
        background: rgba(20, 20, 20, 0.9);
        border-left: 6px solid #c79b4b;
        border-radius: 18px;
        padding: 30px;
        margin: 25px 0;
        width: 100%;
        max-width: 520px;
        box-sizing: border-box;
        box-shadow: 0 0 20px rgba(0,0,0,0.6);
        text-align: left;
    }

    .embed h3 {
        margin-top: 0;
        font-size: 26px;
        color: #e0b76a;
        margin-bottom: 10px;
    }

    .embed p {
        margin: 12px 0;
        font-size: 19px;
        color: #ccc;
    }

    /* BOTÃ•ES */
    button {
        margin-top: 20px;
        width: 100%;
        padding: 26px;
        border-radius: 16px;
        border: none;
        font-size: 23px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
        background: linear-gradient(90deg, #c79b4b, #b28633);
        color: #fff;
        box-shadow: 0 0 12px rgba(199, 155, 75, 0.3);
    }

    button:hover {
        transform: scale(1.04);
        background: linear-gradient(90deg, #e0b76a, #c79b4b);
        box-shadow: 0 0 16px rgba(199, 155, 75, 0.5);
    }

    .confirm-btn {
        background: linear-gradient(90deg, #1e8a44, #28a055);
        color: #fff;
        margin-top: 35px;
        box-shadow: 0 0 14px rgba(30,138,68,0.4);
    }

    .confirm-btn:hover {
        background: linear-gradient(90deg, #2cbc63, #34d171);
        box-shadow: 0 0 20px rgba(46,184,90,0.5);
    }

    .hidden {
        display: none;
    }

    .buttons-confirmed {
        display: flex;
        flex-direction: column;
        gap: 15px;
        width: 100%;
        max-width: 520px;
        margin-top: 20px;
    }

    /* RESPONSIVO */
    @media (max-width: 768px) {
        h2 {
            font-size: 36px;
        }
        .embed {
            padding: 24px;
        }
        .embed h3 {
            font-size: 24px;
        }
        .embed p {
            font-size: 18px;
        }
        button {
            font-size: 21px;
            padding: 22px;
        }
    }
</style>
</head>
<body>
<div class="container">
    <h2>ðŸ’° Aguardando Pagamento</h2>

    <!-- EMBED 1 -->
    <div class="embed">
        <h3>ðŸ’° Status</h3>
        <p>Estamos aguardando a confirmaÃ§Ã£o do seu pagamento.</p>
        <p>Tempo estimado: <strong>10 segundos a 2 minutos</strong>.</p>
    </div>

    <!-- EMBED 2 -->

<div class="embed">
    <h3>
        <!-- Ãcone de verificaÃ§Ã£o -->
        <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:8px;">
            <g fill="none" stroke="#3190bc" stroke-width="1.5">
                <path d="M9.781 3.89c.564-.48.846-.72 1.14-.861a2.5 2.5 0 0 1 2.157 0c.295.14.577.38 1.14.861c.225.192.337.287.457.367a2.5 2.5 0 0 0 .908.376c.141.028.288.04.582.064c.739.058 1.108.088 1.416.197a2.5 2.5 0 0 1 1.525 1.524c.109.309.138.678.197 1.416c.023.294.035.441.063.583c.064.324.192.633.376.907c.08.12.176.232.367.457c.48.564.721.846.862 1.14a2.5 2.5 0 0 1 0 2.157c-.14.294-.381.576-.862 1.14a5 5 0 0 0-.367.457a2.5 2.5 0 0 0-.376.907c-.028.142-.04.289-.063.583c-.059.738-.088 1.108-.197 1.416a2.5 2.5 0 0 1-1.525 1.524c-.308.11-.677.139-1.416.197c-.294.024-.44.036-.582.064a2.5 2.5 0 0 0-.908.376a5 5 0 0 0-.456.367c-.564.48-.846.72-1.14.861a2.5 2.5 0 0 1-2.157 0c-.295-.14-.577-.38-1.14-.861a5 5 0 0 0-.457-.367a2.5 2.5 0 0 0-.908-.376a5 5 0 0 0-.582-.064c-.739-.058-1.108-.088-1.416-.197a2.5 2.5 0 0 1-1.525-1.524c-.109-.308-.138-.678-.197-1.416a5 5 0 0 0-.063-.583a2.5 2.5 0 0 0-.376-.907c-.08-.12-.176-.232-.367-.457c-.48-.564-.721-.846-.862-1.14a2.5 2.5 0 0 1 0-2.157c.141-.294.381-.576.862-1.14c.191-.225.287-.337.367-.457a2.5 2.5 0 0 0 .376-.907c.028-.142.04-.289.063-.583c.059-.738.088-1.107.197-1.416A2.5 2.5 0 0 1 6.42 4.894c.308-.109.677-.139 1.416-.197c.294-.024.44-.036.582-.064a2.5 2.5 0 0 0 .908-.376c.12-.08.232-.175.456-.367Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
            </g>
        </svg>
        VerificaÃ§Ã£o
    </h3>
    <p id="mensagem">Verificando automaticamente...</p>
    <p id="contador">PrÃ³xima tentativa em: 10s</p>
    <button id="verificar">
        <!-- Ãcone de verificaÃ§Ã£o -->
        <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:6px;">
            <g fill="none" stroke="#3190bc" stroke-width="1.5">
                <path d="M9.781 3.89c.564-.48.846-.72 1.14-.861a2.5 2.5 0 0 1 2.157 0c.295.14.577.38 1.14.861c.225.192.337.287.457.367a2.5 2.5 0 0 0 .908.376c.141.028.288.04.582.064c.739.058 1.108.088 1.416.197a2.5 2.5 0 0 1 1.525 1.524c.109.309.138.678.197 1.416c.023.294.035.441.063.583c.064.324.192.633.376.907c.08.12.176.232.367.457c.48.564.721.846.862 1.14a2.5 2.5 0 0 1 0 2.157c-.14.294-.381.576-.862 1.14a5 5 0 0 0-.367.457a2.5 2.5 0 0 0-.376.907c-.028.142-.04.289-.063.583c-.059.738-.088 1.108-.197 1.416a2.5 2.5 0 0 1-1.525 1.524c-.308.11-.677.139-1.416.197c-.294.024-.44.036-.582.064a2.5 2.5 0 0 0-.908.376a5 5 0 0 0-.456.367c-.564.48-.846.72-1.14.861a2.5 2.5 0 0 1-2.157 0c-.295-.14-.577-.38-1.14-.861a5 5 0 0 0-.457-.367a2.5 2.5 0 0 0-.908-.376a5 5 0 0 0-.582-.064c-.739-.058-1.108-.088-1.416-.197a2.5 2.5 0 0 1-1.525-1.524c-.109-.308-.138-.678-.197-1.416a5 5 0 0 0-.063-.583a2.5 2.5 0 0 0-.376-.907c-.08-.12-.176-.232-.367-.457c-.48-.564-.721-.846-.862-1.14a2.5 2.5 0 0 1 0-2.157c.141-.294.381-.576.862-1.14c.191-.225.287-.337.367-.457a2.5 2.5 0 0 0 .376-.907c.028-.142.04-.289.063-.583c.059-.738.088-1.107.197-1.416A2.5 2.5 0 0 1 6.42 4.894c.308-.109.677-.139 1.416-.197c.294-.024.44-.036.582-.064a2.5 2.5 0 0 0 .908-.376c.12-.08.232-.175.456-.367Z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="m8.5 12.5l2 2l5-5" />
            </g>
        </svg>
        Verificar Pagamento
    </button>
</div>

<!-- BOTÃ•ES FINAIS -->
<div id="botoes-confirmados" class="buttons-confirmed hidden">
    <form action="{{ url_for('dashboard') }}" method="get">
        <button type="submit">
            <!-- Ãcone voltar -->
            <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 16 16" style="vertical-align:middle;margin-right:6px;">
                <path fill="#17de20" fill-rule="evenodd" d="m2.87 7.75l1.97 1.97a.75.75 0 1 1-1.06 1.06L.53 7.53L0 7l.53-.53l3.25-3.25a.75.75 0 0 1 1.06 1.06L2.87 6.25h9.88a3.25 3.25 0 0 1 0 6.5h-2a.75.75 0 0 1 0-1.5h2a1.75 1.75 0 1 0 0-3.5z" clip-rule="evenodd"/>
            </svg>
            Voltar Ã  Dashboard
        </button>
    </form>

    <form action="{{ url_for('adicionar_saldo_user') }}" method="get">
        <button type="submit" class="confirm-btn">
            <!-- Ãcone adicionar saldo -->
            <svg xmlns="http://www.w3.org/2000/svg" width="42" height="42" viewBox="0 0 24 24" style="vertical-align:middle;margin-right:8px;">
                <path fill="#2f9786" d="m15.45 16.52l-3.01-3.01c-.11-.11-.24-.13-.31-.13s-.2.02-.31.13L8.8 16.53c-.34.34-.87.89-2.64.89l3.71 3.7a3 3 0 0 0 4.24 0l3.72-3.71c-.91 0-1.67-.18-2.38-.89M8.8 7.47l3.02 3.02c.08.08.2.13.31.13s.23-.05.31-.13l2.99-2.99c.71-.74 1.52-.91 2.43-.91l-3.72-3.71a3 3 0 0 0-4.24 0l-3.71 3.7c1.76 0 2.3.58 2.61.89"/>
                <path fill="#2f9786" d="m21.11 9.85l-2.25-2.26H17.6c-.54 0-1.08.22-1.45.61l-3 3c-.28.28-.65.42-1.02.42a1.5 1.5 0 0 1-1.02-.42L8.09 8.17c-.38-.38-.9-.6-1.45-.6H5.17l-2.29 2.3a3 3 0 0 0 0 4.24l2.29 2.3h1.48c.54 0 1.06-.22 1.45-.6l3.02-3.02c.28-.28.65-.42 1.02-.42s.74.14 1.02.42l3.01 3.01c.38.38.9.6 1.45.6h1.26l2.25-2.26a3.04 3.04 0 0 0-.02-4.29"/>
            </svg>
            Adicionar Saldo Novamente
        </button>
    </form>
</div>

<script>
let txid = "{{ txid }}";
const botao = document.getElementById("verificar");
const contadorEl = document.getElementById("contador");
const mensagemEl = document.getElementById("mensagem");
const botoesConfirmados = document.getElementById("botoes-confirmados");

const TENTATIVAS = 6;
const INTERVALO = 10;
let tentativasRestantes = TENTATIVAS;
let contador = INTERVALO;

// FunÃ§Ã£o de verificaÃ§Ã£o
async function verificarPagamento() {
    botao.disabled = true;
    mensagemEl.innerText = "Verificando...";
    try {
        let resp = await fetch(`/verificar_pagamento_ajax/${txid}`);
        let data = await resp.json();

        if (data.status && data.status.toLowerCase() === "concluida") {
            mensagemEl.innerText = `âœ… Pagamento confirmado! Saldo adicionado: R$ ${parseFloat(data.valor).toFixed(2)}`;
            contadorEl.style.display = 'none';
            botao.style.display = 'none';
            botoesConfirmados.classList.remove('hidden');
        } else if (data.status) {
            mensagemEl.innerText = "âŒ› Pagamento ainda nÃ£o confirmado...";
        } else {
            mensagemEl.innerText = "âŒ Erro: resposta invÃ¡lida do servidor.";
        }
    } catch (e) {
        console.error(e);
        mensagemEl.innerText = "âŒ Erro ao verificar pagamento.";
    }
}

// Contador automÃ¡tico
function iniciarContador() {
    contadorEl.style.display = 'block';
    contador = INTERVALO;
    let timer = setInterval(() => {
        contador--;
        contadorEl.innerText = `PrÃ³xima tentativa em: ${contador}s`;
        if (contador <= 0) {
            clearInterval(timer);
            if (tentativasRestantes > 0) {
                verificarPagamento();
                tentativasRestantes--;
                if (tentativasRestantes > 0) {
                    iniciarContador();
                } else {
                    botao.disabled = false;
                    contadorEl.innerText = `VocÃª pode tentar novamente clicando no botÃ£o.`;
                }
            }
        }
    }, 1000);
}

// Inicia verificaÃ§Ãµes automÃ¡ticas
verificarPagamento();
tentativasRestantes--;
iniciarContador();

// BotÃ£o manual
botao.addEventListener("click", () => {
    tentativasRestantes = TENTATIVAS;
    verificarPagamento();
    tentativasRestantes--;
    iniciarContador();
});
</script>
</body>
</html>
